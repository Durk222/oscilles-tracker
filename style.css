/* OSCILLESTRACKER - PRO EDITION FINAL */
:root {
    --bg-dark: #0a0a0b;
    --rack-bg: #1e1e20;
    --panel-bg: #262629;
    --text-main: #e0e0e0;
    --text-dim: #666;
    --border: #38383b;
}

* { box-sizing: border-box; }

body {
    background-color: var(--bg-dark);
    color: var(--text-main);
    font-family: 'Roboto Mono', monospace;
    margin: 0;
    overflow: hidden;
    height: 100vh;
}

/* --- ESTRUCTURA PRINCIPAL --- */
.app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.rack-header {
    background: #1a1a1c;
    border-bottom: 2px solid #000;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 55px;
    flex-shrink: 0;
}

/* --- TOOLBAR (Z-INDEX CRÍTICO) --- */
.main-toolbar {
    background: #111;
    display: flex;
    gap: 15px;
    padding: 0 20px;
    font-size: 11px;
    border-bottom: 1px solid #333;
    height: 28px;
    align-items: center;
    position: relative;
    z-index: 9999;
}

.toolbar-item { cursor: pointer; position: relative; color: #888; }
.toolbar-item:hover { color: #fff; }

.dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: #2a2a2d;
    border: 1px solid #000;
    min-width: 180px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.5);
}

.toolbar-item:hover .dropdown { display: block; }
.dropdown span {
    display: block;
    padding: 10px 15px;
    border-bottom: 1px solid #333;
}
.dropdown span:hover { background: #444; color: #22ff88; }

/* --- CONTENEDOR DE PISTAS --- */
#rackBody {
    flex: 1;
    display: flex;
    overflow-x: auto;
    overflow-y: hidden;
    background: #000;
    padding: 10px;
    gap: 5px;
    align-items: stretch;
}

/* --- MÓDULO DE PISTA --- */
.track-module {
    --track-color: #ff9900;
    --track-color-rgb: 255, 153, 0;
    background: var(--panel-bg);
    width: 380px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    border-top: 4px solid var(--track-color);
    transition: opacity 0.2s;
}

.track-header {
    padding: 8px;
    background: rgba(0,0,0,0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
}

/* --- EL TRACKER (GRILLA) --- */
.track-interface {
    flex: 1;
    display: flex;
    overflow: hidden;
    background: #000;
    position: relative;
}

.column { position: relative; height: 100%; overflow: hidden; border-right: 1px solid #111; }
.col-left, .col-right { width: 60px; background: rgba(var(--track-color-rgb), 0.05); }
.col-mid { flex: 1; }

.tracker-grid-container {
    height: 100%;
    position: relative;
}

.tracker-rows {
    position: absolute;
    width: 100%;
    will-change: transform;
    transition: transform 0.08s cubic-bezier(0, 0, 0.2, 1);
}

.tracker-row {
    height: 15px;
    display: flex;
    border-bottom: 1px solid #111;
}

.row-number { width: 30px; font-size: 9px; color: #444; text-align: center; line-height: 15px; }

.tracker-cell {
    flex: 1;
    background: transparent;
    border: none;
    color: #777;
    font-family: inherit;
    font-size: 10px;
    text-align: center;
    outline: none;
}

.note-cell { color: var(--track-color); font-weight: bold; }
.note-cell:focus { background: #fff !important; color: #000 !important; }

/* --- VISUALIZACIÓN --- */
.midi-canvas, .wave-chart-container {
    width: 100% !important;
    height: 100% !important;
}

/* --- ESTADOS Y ANIMACIONES --- */
.tracker-row.flash {
    background: rgba(var(--track-color-rgb), 0.4) !important;
}

.measure-highlight { background: rgba(255,255,255,0.08); }
.beat-highlight { background: rgba(255,255,255,0.03); }

.muted-effect { opacity: 0.3; filter: grayscale(1); pointer-events: none; }
.muted-effect .track-controls { pointer-events: auto; }

/* --- INTERFAZ DE AUDIO --- */
.master-vu-container { width: 120px; }
.vu-meter { height: 8px; background: #000; border: 1px solid #333; position: relative; }
#masterVuFill { 
    height: 100%; 
    background: linear-gradient(to right, #22ff88, #ffff00, #ff4444); 
    width: 0%; 
    transition: width 0.1s ease;
}

.transport button {
    background: #333; border: 1px solid #000; color: #fff;
    padding: 5px 15px; cursor: pointer; font-family: inherit;
}
.transport button:hover { background: #444; }

#bpmInput {
    background: #000; border: 1px solid #444; color: #22ff88;
    width: 50px; text-align: center; font-weight: bold;
}
